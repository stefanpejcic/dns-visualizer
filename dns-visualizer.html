{% extends 'base.html' %}

{% block content %}

<div class="border-b flex flex-col border-gray-200 bg-gray-50 dark:border-gray-800 dark:bg-gray-950 p-4 sm:p-6 lg:p-8 sm:flex-row sm:items-center sm:justify-between">
        <div>
        <div class="flex items-center gap-x-3"><h1 class="text-lg font-semibold text-gray-900 dark:text-gray-50">{{_('DNS Visualizer')}}</h1></div>
        
        <p class="text-sm text-gray-500 dark:text-gray-500">{{_('Enter domain name to check and visualize DNS zone.')}}</p>
    </div>
    <div class="gap-2 sm:flex">
        <form id="dnsForm" method="get" action="/domains/dns-visualizer/raw" target="result_frame" class="space-y-4 flex gap-4 items-center">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
          <div>
            <label class="block text-sm text-gray-500 dark:text-gray-500">Domain:</label>
            <input class="border rounded px-2 py-1 w-full" type="text" name="domain" value="{{ domain | default('') }}" required>
          </div>
          
          <div>
            <label class="block text-sm text-gray-500 dark:text-gray-500">Record Type (optional):</label>
            <select class="border rounded px-2 py-1 w-full" name="type">
              <option value="" {% if not record_type %}selected{% endif %}>ALL</option>
              {% for t in supported_types %}
              <option value="{{ t }}" {% if record_type==t %}selected{% endif %}>{{ t }}</option>
              {% endfor %}
            </select>
          </div>
        
          <div class="hidden">
            <label class="block text-sm text-gray-500 dark:text-gray-500">Depth:</label>
            <input class="border rounded px-2 py-1 w-full" type="number" name="depth" value="{{ depth | default(1) }}" min="1">
          </div>
        
          <div>
            <label class="block text-sm text-gray-500 dark:text-gray-500">Output:</label>
            <select class="border rounded px-2 py-1 w-full" name="output">
              <option value="html" {% if output=='html' %}selected{% endif %}>Interactive HTML</option>
              <option value="json" {% if output=='json' %}selected{% endif %}>JSON</option>
              <option value="text" {% if output=='text' %}selected{% endif %}>Text</option>
            </select>
          </div>
        
          <div>
            <button id="analyzeBtn" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600 flex items-center gap-2" type="submit">
              <span id="btnText">Analyze</span>
              <svg id="spinner" class="animate-spin h-5 w-5 text-white hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
              </svg>
            </button>
          </div>
        </form>
    </div>
</div>

<iframe name="result_frame" style="width:100%; height:800px;" frameborder="0" id="resultFrame"></iframe>

<script>
const form = document.getElementById('dnsForm');
const btn = document.getElementById('analyzeBtn');
const spinner = document.getElementById('spinner');
const btnText = document.getElementById('btnText');
const iframe = document.getElementById('resultFrame');

form.addEventListener('submit', (e) => {
    btn.disabled = true;
    btnText.textContent = 'Analyzing...';
    spinner.classList.remove('hidden');
    const formData = new FormData(form);
    const params = new URLSearchParams();
    for (const [key, value] of formData.entries()) {
        if (value) params.set(key, value);
    }
    const newUrl = window.location.pathname + '?' + params.toString();
    history.replaceState(null, '', newUrl);
});

iframe.addEventListener('load', () => {
    btn.disabled = false;
    btnText.textContent = 'Analyze';
    spinner.classList.add('hidden');
});

window.addEventListener('DOMContentLoaded', () => {
    const urlParams = new URLSearchParams(window.location.search);
    let shouldSubmit = false;
    for (const [key, value] of urlParams.entries()) {
        const field = form.elements[key];
        if (field && value) {
            field.value = value;
            shouldSubmit = true;
        }
    }
    if (shouldSubmit) {
        btn.disabled = true;
        btnText.textContent = 'Analyzing...';
        spinner.classList.remove('hidden');
        form.submit();
    }
});
</script>


{% endblock %}
